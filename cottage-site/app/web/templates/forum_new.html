{% extends "base.html" %}
{% block content %}
<section class="container mx-auto px-4 py-12 max-w-3xl" x-data="{ body: '' }">
  <div class="flex items-center justify-between mb-6">
    <h1 class="text-2xl font-semibold">New Thread</h1>
    <a href="/forum" class="px-3 py-1.5 rounded-md border border-slate-700 bg-slate-800 text-slate-100 hover:bg-slate-700">Back</a>
  </div>

  {% if error %}
  <div class="mb-4 p-3 rounded-md bg-rose-900/40 border border-rose-700 text-rose-200 text-sm">{{ error }}</div>
  {% endif %}

  <form method="post" action="/forum/new" class="space-y-5">
    <div>
      <label class="block text-sm text-slate-300 mb-1">Title</label>
      <input name="title" type="text" required class="w-full px-3 py-2 bg-slate-900 border border-slate-700 text-slate-100 placeholder-slate-400 rounded-md focus:outline-none focus:ring-1 focus:ring-indigo-500 focus:border-indigo-500" placeholder="Thread title" />
    </div>

    <div>
      <label class="block text-sm text-slate-300 mb-1">Category</label>
      <select name="category" class="w-full px-3 py-2 bg-slate-900 border border-slate-700 text-slate-100 rounded-md focus:outline-none focus:ring-1 focus:ring-indigo-500 focus:border-indigo-500">
        <option value="">No category</option>
        {% for c in categories or [] %}
        <option value="{{ c.slug }}">{{ c.name }}</option>
        {% endfor %}
      </select>
    </div>

    <div>
      <div class="flex items-center justify-between">
        <label class="block text-sm text-slate-300 mb-1">Body</label>
        <a class="text-xs text-indigo-400 hover:text-indigo-300" href="https://www.markdownguide.org/cheat-sheet/" target="_blank">Markdown help</a>
      </div>
      <textarea name="body" rows="12" required x-model="body" class="w-full px-3 py-2 bg-slate-900 border border-slate-700 text-slate-100 placeholder-slate-400 rounded-md focus:outline-none focus:ring-1 focus:ring-indigo-500 focus:border-indigo-500" placeholder="# Heading\n\nWrite your post using Markdown.\n\n- Bullets\n- **Bold** and _italic_\n- `code` blocks"></textarea>
      <p class="mt-2 text-xs text-slate-400">Tips: Use <code class="px-1 rounded bg-slate-800 border border-slate-700">**bold**</code>, <code class="px-1 rounded bg-slate-800 border border-slate-700">_italic_</code>, <code class="px-1 rounded bg-slate-800 border border-slate-700">`inline code`</code>, and fenced code blocks. Links will be sanitized.</p>
    </div>

    {% if turnstile_site_key %}
    <div class="cf-turnstile" data-sitekey="{{ turnstile_site_key }}" data-theme="dark"></div>
    {% endif %}

    <div class="flex items-center gap-3">
      <a href="/forum" class="px-4 py-2 rounded-md border border-slate-700 bg-slate-800 text-slate-100 hover:bg-slate-700">Cancel</a>
      <button type="submit" class="px-4 py-2 rounded-md bg-indigo-600 text-white hover:bg-indigo-700">Publish</button>
    </div>
  </form>

  <div class="mt-10">
    <h2 class="text-lg font-medium mb-3">Live preview</h2>
    <div class="p-4 rounded-md bg-slate-800 border border-slate-700">
      <article class="prose prose-invert max-w-none" x-html="window.__md.render(body)"></article>
    </div>
  </div>
</section>
{% if turnstile_site_key %}
<script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
{% endif %}
<script src="https://cdn.jsdelivr.net/npm/markdown-it@14.1.0/dist/markdown-it.min.js"></script>
<script>
  window.__md = window.markdownit();
</script>
{% endblock %}
